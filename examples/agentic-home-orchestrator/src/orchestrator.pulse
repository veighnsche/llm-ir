(mod orchestrator
(rails)
(compact core)
(async)
(caps fs proc env time json hash http gpu)
(com doc human "Home Chatbot Orchestrator entrypoint")
(fn start -> res<i32> ()
(let cfg (config.load "src/config_example.json"))
(ok 0))
(com doc human "Spawn worker and stream NDJSON to SSE for a session")
(fn route_stream -> res<i32> (prompt sid)
(pipe (env.get "MODEL_PATH")
(proc.spawn "llama.cpp" (v "-m" $0 "-p" prompt) (v ("GPU" (env.get "GPU_MASK"))) ".")
(handle_worker sid _)
ok 0))
(com doc human "Parse NDJSON line into json value (fail-closed)")
(fn parse_line -> res<val> (line)
(pipe (json.parse line)
(ok _))))
